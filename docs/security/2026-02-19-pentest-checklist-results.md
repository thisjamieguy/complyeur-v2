# ComplyEUR Penetration Checklist Results (Cross-Referenced)

- **Generated on:** 2026-02-19T23:53:17.000Z
- **Source checklist:** `/Users/jameswalsh/Desktop/ComplyEUR_Penetration_Testing_Checklist_v2.md`
- **Reference artifacts:**
  - `docs/security/2026-02-19-pentest-findings.json`
  - `docs/security/2026-02-19-penetration-test-execution-report.md`
  - latest verification rerun logs in this session (`pnpm typecheck`, `pnpm test`, `pnpm test:regression`, targeted Supabase/Mailpit probes)

## Status Legend
- `Remediated`: finding was confirmed and fixed in code for this control.
- `Passed`: control was explicitly executed in this wave with no finding observed.
- `Partial`: spot-check evidence exists but full checklist intent remains incomplete.
- `Blocked`: control execution prevented by external/tooling constraints.
- `Pending`: not fully executed in this wave yet.

## Coverage Snapshot
- Total checklist items: **313**
- Remediated: **10**
- Passed: **18**
- Partial: **1**
- Blocked: **3**
- Pending: **281**

## Evidence Index
- **F-001** (Remediation): CEUR-PT-001 privileged MFA enforcement moved from allowlist to privilege-based policy.
  - `docs/security/2026-02-19-pentest-findings.json:3`
  - `lib/security/mfa.ts:23`
  - `lib/security/authorization.ts:56`
  - `app/(dashboard)/layout.tsx:20`
  - `lib/admin/auth.ts:64`
- **F-002** (Remediation): CEUR-PT-002 health endpoint response minimized and rate-limit coverage restored.
  - `docs/security/2026-02-19-pentest-findings.json:29`
  - `app/api/health/route.ts:7`
  - `middleware.ts:74`
  - `__tests__/unit/health-route.test.ts:17`
  - `__tests__/unit/middleware-health-rate-limit.test.ts:46`
- **F-003** (Remediation): CEUR-PT-003 trusted client-IP parsing centralized; spoof/ambiguity handling added.
  - `docs/security/2026-02-19-pentest-findings.json:51`
  - `lib/security/client-ip.ts:71`
  - `lib/rate-limit.ts:197`
  - `app/(auth)/actions.ts:45`
  - `__tests__/unit/client-ip.test.ts:8`
- **F-004** (Remediation): CEUR-PT-004 CSP hardened to nonce-based policy; unsafe directives removed in production.
  - `docs/security/2026-02-19-pentest-findings.json:74`
  - `lib/security/csp.ts:5`
  - `middleware.ts:14`
  - `app/layout.tsx:33`
  - `__tests__/unit/csp.test.ts:11`
- **F-005** (Remediation): CEUR-PT-005 framework fingerprinting header disabled.
  - `docs/security/2026-02-19-pentest-findings.json:96`
  - `next.config.ts:5`
- **F-006** (Remediation): CEUR-PT-006 request-size controls aligned across middleware/import with shared constants.
  - `docs/security/2026-02-19-pentest-findings.json:115`
  - `lib/constants/request-limits.ts:1`
  - `middleware.ts:66`
  - `types/import.ts:22`
  - `__tests__/unit/middleware-body-limit.test.ts:46`
  - `__tests__/unit/request-limits.test.ts:10`
- **F-007** (Remediation): CEUR-PT-007 auth link origin derivation hardened to canonical app URL; header-derived origin fallback removed.
  - `docs/security/2026-02-19-pentest-findings.json:138`
  - `lib/env.ts:64`
  - `__tests__/unit/env-base-url.test.ts:1`
- **F-008** (Remediation): CEUR-PT-008 Supabase auth password policy hardened to minimum length 8 plus mixed-case/digit requirements.
  - `docs/security/2026-02-19-pentest-findings.json:161`
  - `supabase/config.toml:174`
  - `__tests__/unit/supabase-auth-config.test.ts:1`
- **NF-001** (No Finding): Open-redirect probe on auth callback did not redirect externally.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:207`
- **NF-002** (No Finding): Multi-tenant dashboard isolation E2E passed.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:208`
  - `e2e/multi-user-isolation.spec.ts:221`
- **NF-003** (No Finding): CORS spot-check on billing endpoint was non-permissive.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:206`
- **NF-004** (No Finding): Exposure spot-checks for /.git and /.env returned non-exposed results.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:204`
  - `docs/security/2026-02-19-penetration-test-execution-report.md:205`
- **NF-005** (No Finding): _next/data probe returned 404 in executed path.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:203`
- **NF-006** (No Finding): Login wrong-password and non-existent-email attempts returned identical error text in Supabase auth probe.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:268`
- **NF-007** (No Finding): Forgot-password requests for existing vs non-existing email both returned success/no-error in Supabase auth probe.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:269`
- **NF-008** (No Finding): Session fixation probe confirmed access/refresh token rotation across re-login.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:274`
- **NF-009** (No Finding): Session refresh probe returned rotated refresh token and 3600-second session expiry.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:275`
- **NF-010** (No Finding): Concurrent session probe created distinct access/refresh tokens for two clients.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:276`
- **NF-011** (No Finding): Logout completeness probe showed global sign-out revokes other session refresh tokens.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:277`
- **NF-012** (No Finding): Password reset token probe showed first use succeeds and second use is rejected as expired/invalid.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:284`
- **VR-001** (Verification): Full verification rerun on final main: typecheck/test/e2e outcomes recorded.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:239`
  - `docs/security/2026-02-19-penetration-test-execution-report.md:240`
  - `docs/security/2026-02-19-penetration-test-execution-report.md:241`
  - `docs/security/2026-02-19-penetration-test-execution-report.md:242`
  - `docs/security/2026-02-19-penetration-test-execution-report.md:243`
- **BL-001** (Blocked): Dependency audit blocked by npm audit endpoint availability/network constraints.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:225`
  - `docs/security/2026-02-19-penetration-test-execution-report.md:226`
  - `docs/security/2026-02-19-penetration-test-execution-report.md:227`
- **BL-002** (Blocked): App-layer brute-force rate-limit verification blocked because local environment has no Upstash configuration; middleware runs fail-open in dev mode.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:271`
  - `docs/security/2026-02-19-penetration-test-execution-report.md:282`
- **BL-003** (Blocked): App-layer password-reset rate-limit verification blocked for the same Upstash-unconfigured dev-mode reason.
  - `docs/security/2026-02-19-penetration-test-execution-report.md:272`
  - `docs/security/2026-02-19-penetration-test-execution-report.md:282`

---

## Checklist With Current Status

# ComplyEUR v2 — Penetration Testing Checklist

**Application:** ComplyEUR (B2B SaaS — EU 90/180-day Schengen visa compliance tracker)  
**Stack:** Next.js (App Router) + Supabase (PostgreSQL, Auth, Edge Functions) + Stripe + Vercel  
**Date prepared:** 2026-02-19  
**Version:** 2.1 (expanded + cache/proxy/logging hardening)

---

## Table of Contents

1. [Authentication & Session Management](#1-authentication--session-management)
2. [Authorization & Access Control](#2-authorization--access-control)
3. [Input Validation & Injection](#3-input-validation--injection)
4. [API Security](#4-api-security)
5. [Stripe & Billing Security](#5-stripe--billing-security)
6. [File Upload & Import](#6-file-upload--import)
7. [GDPR & Data Protection](#7-gdpr--data-protection)
8. [Security Headers & Transport](#8-security-headers--transport)
9. [Business Logic](#9-business-logic)
10. [Infrastructure & Configuration](#10-infrastructure--configuration)
11. [Denial of Service (Application-Level)](#11-denial-of-service-application-level)
12. [Compliance-Specific Risks](#12-compliance-specific-risks)
13. [Supply Chain & Dependency Security](#13-supply-chain--dependency-security)
14. [Email System Security (Resend)](#14-email-system-security-resend)
15. [Race Conditions (TOCTOU)](#15-race-conditions-toctou)
16. [Client-Side Security](#16-client-side-security)
17. [Vercel Preview Deployment Abuse](#17-vercel-preview-deployment-abuse)
18. [Key Files for Testing Reference](#key-files-for-testing-reference)
19. [Notes for the Tester](#notes-for-the-tester)
20. [Priority Ranking](#priority-ranking)

---

## 1. Authentication & Session Management

### 1.1 Email/Password Authentication

- [ ] [Blocked] Brute-force login attempts — verify rate limiting kicks in (configured: 10 req/min per IP) [Refs: BL-002] — Blocked at 2026-02-19T23:53:17Z: local dev run logs show `Upstash not configured. Rate limiting disabled (dev mode)`, so app-layer 10/min enforcement cannot be executed in this environment.
- [x] [Passed] User enumeration via login error messages — confirm identical responses for invalid email vs wrong password [Refs: NF-006] — Supabase auth probe returned `Invalid login credentials` for both cases.
- [ ] [Pending] User enumeration via signup — confirm identical responses for existing vs new email — Probe shows distinguishable outcomes (`User already registered` vs successful user creation); requires product-level flow change for response parity.
- [x] [Passed] User enumeration via forgot-password — confirm success response regardless of email existence [Refs: NF-007] — Both existing and non-existing addresses returned success/no-error in probe.
- [x] [Remediated] Password complexity enforcement — test minimum length and character requirements (Supabase-managed) [Refs: F-008] — Supabase auth config now enforces min length 8 and mixed-case+digit requirement; weak password probe now fails.
- [x] [Passed] Account lockout mechanism — test whether repeated failures lock the account or just rate-limit [Refs: NF-006] — No account lockout observed; repeated failed logins continued returning generic invalid-credentials response.
- [x] [Passed] Session fixation — confirm session token is rotated after login [Refs: NF-008] — Re-login issued different access and refresh tokens.
- [x] [Passed] Session expiry — confirm JWT tokens expire and are refreshed correctly [Refs: NF-009] — Refresh flow succeeded with rotated refresh token and `expires_in=3600`.
- [x] [Passed] Concurrent session handling — log in from multiple devices, verify session isolation [Refs: NF-010] — Concurrent clients received distinct access/refresh token pairs.
- [x] [Passed] Logout completeness — confirm session is fully invalidated server-side on logout [Refs: NF-011] — Global sign-out caused other session refresh to fail (`Invalid Refresh Token: Refresh Token Not Found`).
- [x] [Passed] Password reset token expiry — confirm tokens expire (~1 hour expected) [Refs: NF-012] — Recovery redirect payload includes `expires_in=3600`; reused token path returns `otp_expired`.
- [x] [Passed] Password reset token reuse — confirm tokens are single-use [Refs: NF-012] — First recovery link use succeeded; second use returned `error_code=otp_expired`.
- [ ] [Blocked] Password reset rate limiting — verify stricter limit (configured: 5 req/hour per IP) [Refs: BL-003] — Blocked at 2026-02-19T23:53:17Z due same local dev Upstash-unconfigured fail-open behavior.
- [x] [Remediated] Password reset/invite link poisoning — submit requests with manipulated `Host`/`X-Forwarded-Host`, verify generated links always use canonical app URL [Refs: F-007] — Base URL helper now ignores request host headers and uses canonical environment origin only.

### 1.2 OAuth (Google)

- [ ] [Pending] OAuth account linking attack — register email/password, then try to log in via Google with same email (should be blocked by `auth-hook-prevent-linking` edge function)
- [ ] [Pending] OAuth state parameter validation — confirm CSRF protection on OAuth callback
- [x] [Passed] OAuth callback open redirect — test `/auth/callback?next=//evil.com` and other bypass patterns [Refs: NF-001, VR-001] — Redirect remained local; external redirect bypass not observed.
- [ ] [Pending] OAuth PKCE/nonce enforcement — replay authorization code without valid verifier/nonce should fail
- [ ] [Pending] OAuth scope verification — confirm only minimal scopes are requested
- [ ] [Pending] OAuth token storage — confirm tokens are stored securely (httpOnly cookies, not localStorage)
- [ ] [Pending] Company name inference via email domain — test if attacker can claim a company name by registering with a specific domain email

### 1.3 Multi-Factor Authentication (MFA)

- [ ] [Pending] MFA bypass — attempt to access protected routes without completing MFA challenge
- [ ] [Pending] MFA enrollment manipulation — test if user can unenroll MFA to bypass enforcement
- [ ] [Pending] MFA code brute-force — test rate limiting on TOTP verification attempts
- [ ] [Pending] MFA recovery flow — test backup code usage and rate limits
- [x] [Remediated] MFA enforcement scope — currently only enforced for hardcoded admin emails; verify non-admin users can't access admin features without MFA [Refs: F-001, VR-001] — Privileged MFA policy corrected and re-verified.

### 1.4 JWT-Specific Attacks ⭐ NEW

- [ ] [Pending] JWT algorithm confusion — send token with `alg: none` or switch from RS256 to HS256
- [ ] [Pending] JWT claim tampering — modify `sub`, `role`, or `company_id` claims in decoded token, re-sign with guessed/leaked key
- [ ] [Pending] JWT `kid` header injection — if Supabase uses key ID, test for path traversal or SQL injection via `kid`
- [ ] [Pending] Refresh token theft — verify refresh tokens are rotated on use (one-time use) and old ones are invalidated
- [ ] [Pending] Token leakage via Referrer header — navigate from authenticated page to external link, check if JWT appears in Referrer

### 1.5 Account Takeover Patterns ⭐ NEW

- [ ] [Pending] Password reset link manipulation — modify email parameter in reset request after token generation
- [ ] [Pending] OAuth email change attack — change Google account email to victim's email, then OAuth login
- [ ] [Pending] Session persistence after password change — verify all other sessions are invalidated when password is changed
- [ ] [Pending] Session persistence after email change — same check for email change
- [ ] [Pending] Account recovery with deleted email — delete Google account, re-register same email, attempt OAuth login

---

## 2. Authorization & Access Control

### 2.1 Role-Based Access Control (RBAC)

Roles: Owner > Admin > Manager > Viewer

- [ ] [Pending] Vertical privilege escalation — Viewer attempts to create/update/delete employees (should fail)
- [ ] [Pending] Vertical privilege escalation — Manager attempts to delete employees (should fail, only Owner/Admin)
- [ ] [Pending] Vertical privilege escalation — Manager attempts to manage team members/invites (should fail)
- [ ] [Pending] Vertical privilege escalation — Manager/Viewer attempts to modify company settings (should fail)
- [ ] [Pending] Vertical privilege escalation — Non-owner attempts GDPR actions (DSAR export, anonymize, delete)
- [ ] [Pending] Role self-elevation — user modifies their own role via API manipulation
- [ ] [Pending] Role manipulation via team invite — accept invite and tamper with role assignment
- [ ] [Pending] Privilege revocation latency — downgrade user role (e.g., Admin→Viewer) and verify existing sessions immediately lose elevated permissions
- [ ] [Pending] Permission check consistency — verify every server action enforces `enforceMutationAccess()` (not just UI hiding)
- [ ] [Pending] Direct API call without UI — call server actions directly bypassing client-side permission checks

### 2.2 Multi-Tenant Isolation

- [x] [Passed] Cross-tenant data read — user from Company A attempts to read Company B's employees [Refs: NF-002, VR-001] — Multi-user E2E verified company isolation for employee visibility.
- [ ] [Pending] Cross-tenant data write — user from Company A attempts to modify Company B's trips
- [ ] [Pending] Cross-tenant data delete — user from Company A attempts to delete Company B's employee
- [ ] [Pending] Cross-tenant DSAR export — request `/api/gdpr/dsar/[company-B-employee-id]`
- [ ] [Pending] Cross-tenant trip access — attempt to view/edit trips belonging to another company's employee
- [x] [Passed] Cross-tenant calendar/dashboard — verify dashboard only shows own company's data [Refs: NF-002, VR-001] — Dashboard isolation verified by multi-user E2E.
- [ ] [Pending] Cross-tenant export — verify CSV/PDF exports only contain own company's data
- [ ] [Pending] RLS policy bypass — test if any Supabase queries use service role key unnecessarily
- [ ] [Pending] RLS policy completeness — verify all tables have RLS enabled (auto-enforced by `rls_auto_enable()` trigger)
- [ ] [Pending] Direct database query via Supabase REST API — attempt raw PostgREST queries with anon key to bypass application-level checks

### 2.3 Admin Panel

- [ ] [Pending] Admin panel discovery — access `/admin` as non-admin user (should silently redirect)
- [ ] [Pending] Admin panel access with non-allowlisted email — verify 403/redirect
- [x] [Remediated] Admin panel access without MFA — verify MFA is enforced for admin-level actions [Refs: F-001, VR-001] — Admin/owner MFA gating now enforced by privilege.
- [ ] [Pending] Superadmin flag manipulation — attempt to set `is_superadmin=true` via Supabase REST API
- [ ] [Pending] Admin entitlement tampering — attempt to update another company's tier/limits
- [ ] [Pending] Admin audit log integrity — verify all admin actions are logged with before/after state, IP, user agent
- [ ] [Pending] Admin audit log deletion — verify logs cannot be deleted/modified (INSERT-only table)
- [ ] [Pending] Admin trial extension abuse — extend trial to unreasonable date
- [ ] [Pending] Admin company suspension bypass — suspended company user attempts to access application
- [ ] [Pending] Suspension revocation latency — suspend company/user and verify existing active sessions cannot continue privileged operations

### 2.4 Team Invite Flow Abuse ⭐ NEW

- [ ] [Pending] Invite token brute-force — enumerate/guess invite tokens
- [ ] [Pending] Invite token reuse — accept same invite twice (duplicate team member creation)
- [ ] [Pending] Invite to wrong company — capture invite link, log in as user from different company, accept invite
- [ ] [Pending] Expired invite acceptance — accept invite after expiry window
- [ ] [Pending] Self-invite — generate invite to your own email to escalate role
- [ ] [Pending] Invite enumeration — check if invite endpoints reveal whether an email is already a member
- [ ] [Pending] Race condition on invite acceptance — two users click same invite link simultaneously

### 2.5 IDOR Beyond Multi-Tenant ⭐ NEW

- [ ] [Pending] Sequential ID enumeration — if any IDs are sequential (not UUID), enumerate adjacent records
- [ ] [Pending] UUID prediction — check if UUIDs are v1 (timestamp-based, predictable) vs v4 (random)
- [ ] [Pending] Indirect object references — employee ID in URL used to access trips, then swap employee ID for one in same company but outside your role scope (Manager accessing another Manager's restricted employees)

---

## 3. Input Validation & Injection

### 3.1 SQL Injection

- [ ] [Pending] Employee name field — `'; DROP TABLE employees; --`
- [ ] [Pending] Company name field — `' OR '1'='1`
- [ ] [Pending] Trip country field — test against 2-char ISO code CHECK constraint
- [ ] [Pending] Search/filter parameters — inject SQL via query parameters
- [ ] [Pending] Import CSV employee names — SQL payloads in imported data
- [ ] [Pending] Supabase RPC parameters — test `create_company_and_profile()` with malicious inputs
- [ ] [Pending] Supabase PostgREST filter parameters — test `.eq()`, `.like()`, `.in()` with injection payloads

### 3.2 Cross-Site Scripting (XSS)

- [ ] [Pending] Stored XSS via employee name — `<script>alert('xss')</script>`
- [ ] [Pending] Stored XSS via company name — `<img src=x onerror="alert('xss')">`
- [ ] [Pending] Stored XSS via trip notes/comments — if any free-text fields exist
- [ ] [Pending] Stored XSS via CSV import — import file with XSS payloads in all columns
- [ ] [Pending] Reflected XSS via URL parameters — test all query parameters in dashboard routes
- [ ] [Pending] Reflected XSS via error messages — test if error messages echo user input unsanitized
- [ ] [Pending] DOM XSS via redirect parameter — test `redirectTo` parameter in auth flows
- [ ] [Pending] CSP bypass — current policy includes `'unsafe-inline'` for scripts, test if inline XSS executes

### 3.3 CSV/Formula Injection

- [ ] [Pending] CSV injection via employee name — `=cmd|'/C calc'!A0`
- [ ] [Pending] CSV injection via export — verify `sanitizeCsvValue()` escapes formula characters (`=`, `+`, `-`, `@`, `\t`, `\r`)
- [ ] [Pending] CSV injection via import → export cycle — import data with formula chars, then export and open in Excel
- [ ] [Pending] Tab/newline injection in CSV fields — test if exported CSV can break cell boundaries

### 3.4 Server-Side Request Forgery (SSRF)

- [ ] [Pending] OAuth redirect URL manipulation — test if callback URL can be redirected to internal services
- [ ] [Pending] Stripe webhook URL — verify webhook endpoint doesn't follow redirects
- [ ] [Pending] Supabase connection strings — verify no user-controlled database connection parameters

### 3.5 Open Redirect

- [ ] [Pending] Login redirect — `/login?redirectTo=//evil.com`
- [ ] [Pending] Login redirect — `/login?redirectTo=/\evil.com`
- [ ] [Pending] Login redirect — `/login?redirectTo=javascript:alert(1)`
- [ ] [Pending] OAuth redirect — `signInWithGoogle(redirectTo: '//evil.com')`
- [ ] [Pending] Post-signup redirect — verify redirect after account creation
- [ ] [Pending] Stripe checkout return URL — verify `success_url` and `cancel_url` are hardcoded

### 3.6 Server Action Specific ⭐ NEW

- [ ] [Pending] Next.js Server Action replay — capture and replay server action requests with modified `$ACTION_ID`
- [ ] [Pending] Server Action parameter pollution — add unexpected fields to server action payloads
- [ ] [Pending] Server Action without bound args — call server actions directly, bypassing `bind()` closures that pass company_id
- [ ] [Pending] Prototype pollution via JSON payload — send `{"__proto__": {"isAdmin": true}}` in request bodies
- [ ] [Pending] Unicode normalization attacks — use Unicode confusables in employee names (e.g., Cyrillic "а" vs Latin "a") for duplicate bypass

### 3.7 Date/Time Manipulation ⭐ NEW

- [ ] [Pending] Date parsing discrepancy — submit dates in ambiguous formats (01/02/2025 — is it Jan 2 or Feb 1?) across different endpoints
- [ ] [Pending] Negative timestamp — submit dates before epoch
- [ ] [Pending] Year 2038 problem — submit dates near Unix timestamp overflow
- [ ] [Pending] Timezone abuse on trip boundaries — trip ending at 23:59 in one timezone but crossing into next day in UTC, affecting day counts

---

## 4. API Security

### 4.1 Rate Limiting

- [ ] [Pending] API route rate limit — exceed 60 req/min to any `/api/*` endpoint
- [ ] [Pending] Auth rate limit — exceed 10 req/min on login/signup
- [ ] [Pending] Password reset rate limit — exceed 5 req/hour
- [x] [Remediated] Rate limit bypass via `X-Forwarded-For` header spoofing [Refs: F-003, VR-001] — Trusted proxy parsing and ambiguity rejection added.
- [ ] [Pending] Rate limit bypass via IPv6 rotation
- [x] [Remediated] Rate limit bypass via `X-Real-IP` header manipulation [Refs: F-003, VR-001] — Trusted client-IP extraction centralized.
- [ ] [Pending] Rate limit headers disclosure — verify `X-RateLimit-Remaining` doesn't leak sensitive info
- [ ] [Pending] Distributed brute-force — same account, different IPs (per-IP limits don't protect against this)
- [ ] [Pending] Server action rate limiting — verify rate limits on all mutation server actions
- [ ] [Pending] Promotion code enumeration — rapid attempts on `/api/billing/checkout` with different codes

### 4.2 API Endpoint Security

- [ ] [Pending] HTTP method tampering — send GET to POST-only endpoints and vice versa
- [ ] [Pending] Content-Type manipulation — send `text/plain` instead of `application/json`
- [x] [Passed] Request body size limit — send >1MB payload to middleware (should return 413) [Refs: F-006, VR-001] — Automated unit checks assert 413 behavior at boundary.
- [x] [Remediated] Request body size vs upload limit mismatch — middleware blocks 1MB but imports allow 5MB files [Refs: F-006, VR-001] — Endpoint-aware body limits aligned (default 1MB, import 10MB).
- [ ] [Pending] Missing authentication — call all API routes without session cookie
- [ ] [Pending] Expired token access — use expired JWT to access protected routes
- [ ] [Pending] HTTP parameter pollution — duplicate sensitive params (`role=user&role=owner`, duplicate `company_id`) and verify deterministic safe handling
- [x] [Remediated] API response information leakage — verify error responses don't expose stack traces or internal paths [Refs: F-002, VR-001] — Health response payload sanitized; no internal diagnostics returned publicly.

### 4.3 CORS & CSRF

- [x] [Passed] CORS configuration — verify `Access-Control-Allow-Origin` is restrictive [Refs: NF-003] — Spot-check did not return permissive ACAO on billing endpoint.
- [ ] [Pending] CSRF on state-changing endpoints — POST to `/api/billing/checkout` from external origin
- [ ] [Pending] CSRF on server actions — invoke Next.js server actions from external origin
- [ ] [Pending] Preflight request handling — verify OPTIONS requests are handled correctly

### 4.4 Next.js Specific ⭐ NEW

- [x] [Passed] `/_next/data/*.json` endpoints — access server-side props data directly without auth [Refs: NF-005] — Probe returned 404 in executed path.
- [ ] [Pending] Middleware bypass via `_next/static` paths — some middleware configs skip static paths, test if API routes can be disguised
- [ ] [Pending] Server component data leak — check if RSC payloads (streamed HTML) contain data the user shouldn't see
- [ ] [Pending] `__nextjs_original-stack-frame` debug endpoint — verify it's disabled in production
- [ ] [Pending] Route group boundary testing — access `(dashboard)` routes without going through layout auth checks by hitting the route directly

### 4.5 Supabase PostgREST Specific ⭐ NEW

- [ ] [Pending] RPC function abuse — call any `rpc/` function directly with anon key, verify auth checks inside functions
- [ ] [Pending] Bulk operations via PostgREST — `PATCH /rest/v1/employees?id=gt.0` to update all rows (RLS should block)
- [ ] [Pending] PostgREST header injection — `Prefer: return=representation` to leak data in responses
- [ ] [Pending] PostgREST column selection — `?select=*,companies(*)` to traverse foreign key relationships and leak parent data
- [ ] [Pending] Supabase `auth.users` table access — verify PostgREST can't query the auth schema directly

### 4.6 Caching & Proxy Abuse ⭐ NEW

- [ ] [Pending] User-specific cache leak — verify Next.js/edge caching (`fetch` cache, route cache, ISR) never serves tenant A data to tenant B
- [ ] [Pending] Web cache deception — request authenticated pages with cacheable-looking suffixes (`/dashboard.css`, encoded path tricks) and verify no private content is cached publicly
- [ ] [Pending] Cache poisoning via forwarding headers — test `X-Forwarded-Host`, `X-Forwarded-Proto`, `X-Original-URL` manipulation and verify cache keys/redirects are not attacker-controlled

---

## 5. Stripe & Billing Security

### 5.1 Webhook Security

- [ ] [Pending] Webhook signature bypass — send webhook without valid Stripe HMAC signature
- [ ] [Pending] Webhook replay attack — capture and replay a valid webhook event (should be deduplicated via `stripe_webhook_events` idempotency)
- [ ] [Pending] Webhook event type spoofing — send `checkout.session.completed` with arbitrary metadata
- [ ] [Pending] Subscription tier escalation — manipulate `metadata.plan_slug` in webhook payload (signature should prevent this)
- [ ] [Pending] Webhook timing attack — send events out of order (e.g., `subscription.deleted` before `checkout.completed`)
- [ ] [Pending] Webhook secret exposure — check if `STRIPE_WEBHOOK_SECRET` appears in logs or error responses

### 5.2 Checkout Flow

- [ ] [Pending] Plan slug manipulation — submit invalid plan slug to `/api/billing/checkout`
- [ ] [Pending] Price ID tampering — verify price ID comes from database, not user input
- [ ] [Pending] Billing interval manipulation — submit invalid interval (not 'monthly' or 'annual')
- [ ] [Pending] Promotion code abuse — test valid codes from other campaigns
- [ ] [Pending] Client reference ID spoofing — verify `client_reference_id` is set server-side from session
- [ ] [Pending] Checkout session hijacking — capture checkout URL, use in different browser/account
- [ ] [Pending] Billing portal IDOR — access Stripe billing portal for another company
- [ ] [Pending] Free tier entitlements — verify free users can't access paid features
- [ ] [Pending] Subscription downgrade handling — verify entitlements are revoked immediately on downgrade
- [ ] [Pending] Trial extension abuse — verify trial can't be extended by user manipulation

---

## 6. File Upload & Import

### 6.1 File Upload Validation

- [ ] [Pending] File type bypass — upload `.exe` renamed to `.csv`
- [ ] [Pending] File type bypass — upload with manipulated MIME type header
- [ ] [Pending] Double extension — upload `malware.csv.exe`
- [ ] [Pending] MIME type vs extension mismatch — valid extension, wrong MIME type
- [ ] [Pending] Null byte injection — `file.csv%00.exe`
- [ ] [Pending] Oversized file — upload file exceeding 5MB limit
- [ ] [Pending] Empty file — upload 0-byte file
- [ ] [Pending] File with no extension — upload file without extension

### 6.2 Content-Based Attacks

- [ ] [Pending] XLSX bomb — upload XLSX with billions of cells (memory exhaustion)
- [ ] [Pending] XLSX XXE — upload XLSX with external entity references in XML internals
- [ ] [Pending] XLSX with macros — upload `.xlsm` with VBA macros
- [ ] [Pending] CSV with excessive columns — test parser handling of unexpected column count
- [ ] [Pending] CSV with excessive rows — test memory limits with millions of rows
- [ ] [Pending] CSV encoding attacks — upload with unusual encodings (UTF-16, UTF-7)
- [ ] [Pending] CSV with embedded nulls — test parser handling of null bytes in data
- [ ] [Pending] Polyglot file — file that is valid as both XLSX and HTML

### 6.3 Import Logic

- [ ] [Pending] Import race condition — two concurrent imports creating duplicate employees
- [ ] [Pending] Import with cross-tenant employee IDs — verify imported data is scoped to current company
- [ ] [Pending] Import column mapping manipulation — tamper with mapping configuration
- [ ] [Pending] Import validation bypass — submit import with invalid data types (non-date in date field)

---

## 7. GDPR & Data Protection

### 7.1 DSAR (Data Subject Access Request) Export

- [ ] [Pending] IDOR on DSAR export — request export for employee belonging to another company
- [ ] [Pending] Unauthorized DSAR — Manager/Viewer role attempts DSAR export (Owner/Admin only)
- [ ] [Pending] DSAR signed URL prediction — attempt to guess or enumerate signed URLs
- [ ] [Pending] DSAR signed URL expiry — access URL after 1-hour expiry window
- [ ] [Pending] DSAR data completeness — verify export contains all personal data (GDPR Article 15 compliance)
- [ ] [Pending] Concurrent DSAR requests — multiple simultaneous requests for same employee

### 7.2 Data Deletion & Anonymization

- [ ] [Pending] Unauthorized deletion — non-Owner/Admin attempts GDPR deletion
- [ ] [Pending] Unauthorized anonymization — non-Owner/Admin attempts employee anonymization
- [ ] [Pending] Anonymization reversibility — verify anonymized data cannot be recovered
- [ ] [Pending] Soft-delete recovery window — verify 30-day recovery window, then hard delete
- [ ] [Pending] Delete then re-create — delete employee, create new one with same details (data leakage check)
- [x] [Passed] CRON retention job authentication — call `/api/gdpr/cron/retention` without valid `CRON_SECRET` [Refs: NF-004] — Unauthorized probe returned 401.
- [ ] [Pending] CRON retention job with invalid token — test with expired or malformed bearer token
- [ ] [Pending] CRON retention job trigger timing — verify job can't be triggered to prematurely delete data

### 7.3 Audit Logging

- [ ] [Pending] GDPR audit log completeness — verify all GDPR actions (export, delete, anonymize, restore) are logged
- [ ] [Pending] Audit log access control — verify only Owner/Admin can view GDPR audit log
- [ ] [Pending] Audit log tampering — verify logs are immutable (no UPDATE/DELETE permissions)

---

## 8. Security Headers & Transport

### 8.1 HTTP Headers

- [x] [Remediated] Content-Security-Policy — currently allows `'unsafe-inline'` for scripts (weakness) [Refs: F-004, VR-001] — Production CSP now nonce-based without unsafe script directives.
- [ ] [Pending] X-Frame-Options — verify `DENY` or `SAMEORIGIN` is set (clickjacking protection)
- [ ] [Pending] X-Content-Type-Options — verify `nosniff` is set (MIME sniffing protection)
- [ ] [Pending] Strict-Transport-Security — verify HSTS header with reasonable `max-age`
- [ ] [Pending] Referrer-Policy — verify sensitive URLs aren't leaked via Referer header
- [ ] [Pending] Permissions-Policy — verify unnecessary browser features (camera, microphone, geolocation) are restricted
- [ ] [Pending] Cache-Control on sensitive endpoints — verify `no-store` on auth and GDPR endpoints
- [x] [Remediated] X-Powered-By — verify framework version isn't disclosed [Refs: F-005, VR-001] — Header disabled in runtime config.

### 8.2 TLS & Transport

- [ ] [Pending] TLS version — verify TLS 1.2+ only (Vercel-managed)
- [ ] [Pending] Certificate validity — verify SSL certificate is valid and not self-signed
- [ ] [Pending] Mixed content — verify no HTTP resources loaded on HTTPS pages
- [ ] [Pending] Cookie flags — verify `Secure`, `HttpOnly`, `SameSite` on session cookies

---

## 9. Business Logic

### 9.1 90/180-Day Compliance Calculations

- [ ] [Pending] Date manipulation — create overlapping trips to confuse day counting
- [ ] [Pending] Timezone exploitation — submit trips with dates that shift across midnight in different timezones (should use `date-fns parseISO`, not native `Date`)
- [ ] [Pending] Boundary testing — trips exactly at 90 days, 180-day window boundaries
- [ ] [Pending] Negative day trips — `exit_date` before `entry_date`
- [ ] [Pending] Zero-day trips — same `entry_date` and `exit_date`
- [ ] [Pending] Future trip handling — trips far in the future
- [ ] [Pending] Retroactive trip modification — modify old trips that affect current compliance status

### 9.2 Seat Limits & Entitlements

- [ ] [Pending] Exceed employee limit — create more employees than tier allows
- [ ] [Pending] Exceed user/seat limit — invite more team members than tier allows
- [ ] [Pending] Feature access beyond tier — access paid features (forecasting, exports, alerts) on free tier
- [ ] [Pending] Tier caching — downgrade tier but continue accessing premium features via cached entitlements
- [ ] [Pending] Concurrent seat usage — race condition on seat creation near limit

### 9.3 Onboarding

- [ ] [Pending] Onboarding bypass — navigate directly to `/dashboard` without completing onboarding
- [ ] [Pending] Onboarding replay — complete onboarding, then revisit `/onboarding`
- [ ] [Pending] Onboarding data manipulation — submit invalid data during onboarding flow

### 9.4 Compliance Algorithm Edge Cases ⭐ NEW

- [ ] [Pending] Microstate trip counting — verify trips to Monaco, San Marino, Vatican count correctly against Schengen days
- [ ] [Pending] Romania/Bulgaria transition — trips before vs after Jan 2025 Schengen membership change
- [ ] [Pending] Multi-country single trip — trip spanning France→Germany→Italy should count as one continuous stay, not three
- [ ] [Pending] 180-day window leap year boundary — test rolling windows that cross Feb 28/29
- [ ] [Pending] Exactly 180 days apart trips — two trips exactly 180 days apart, verify the first one has "expired" from the window
- [ ] [Pending] Mass retroactive trip edit — modify 50 historical trips simultaneously, verify all compliance statuses recalculate correctly

### 9.5 Export/Report Manipulation ⭐ NEW

- [ ] [Pending] PDF generation injection — if generating PDFs, test for SSRF via HTML-to-PDF converters (if using headless Chrome/Puppeteer)
- [ ] [Pending] CSV export timing attack — request export for massive dataset, check for timeout/memory exhaustion
- [ ] [Pending] Audit report timestamp manipulation — verify audit log timestamps are server-generated, not client-provided

---

## 10. Infrastructure & Configuration

### 10.1 Environment & Secrets

- [ ] [Partial] Environment variable exposure — check if `.env`, `.env.local`, `.env.production` are accessible via HTTP [Refs: NF-004] — Executed probe for `/.env` returned 404; additional env path variants still pending.
- [ ] [Pending] Source map exposure — check if JavaScript source maps are served in production
- [x] [Passed] Git directory exposure — check if `/.git/` is accessible [Refs: NF-004] — `/.git/config` probe returned 404.
- [ ] [Pending] Supabase service role key exposure — verify `SUPABASE_SERVICE_ROLE_KEY` never appears in client bundles
- [ ] [Pending] Stripe secret key exposure — verify `STRIPE_SECRET_KEY` never appears in client bundles
- [ ] [Pending] Error stack trace leakage — trigger errors and check for internal path disclosure
- [ ] [Pending] Debug mode — verify no debug endpoints or flags are enabled in production

### 10.2 Supabase-Specific

- [ ] [Pending] Supabase REST API direct access — query PostgREST endpoints directly with anon key
- [ ] [Pending] Supabase Auth admin endpoints — verify admin auth endpoints are restricted
- [ ] [Pending] Supabase Storage bucket permissions — verify `gdpr-exports` bucket is private
- [ ] [Pending] Supabase Edge Function bypass — verify edge functions can't be disabled or circumvented
- [ ] [Pending] Supabase realtime subscriptions — verify RLS applies to realtime listeners (if used)
- [ ] [Pending] Realtime channel authorization — attempt subscription/presence on other-tenant channels and verify unauthorized joins are blocked
- [ ] [Pending] Database connection string exposure — verify connection strings aren't in client code

### 10.3 Vercel-Specific

- [ ] [Pending] Vercel deployment URL exposure — check if preview deployment URLs are guessable
- [ ] [Pending] Vercel serverless function timeout — test long-running requests (e.g., large imports)
- [ ] [Pending] Vercel edge middleware bypass — test if middleware can be bypassed via direct function invocation
- [x] [Passed] `_next/data` endpoint access — verify server-side data fetching endpoints enforce auth [Refs: NF-005] — Probe returned 404 in executed path.

### 10.4 Observability & Logging ⭐ NEW

- [ ] [Pending] Sensitive data redaction in logs — verify tokens, API keys, auth headers, and PII are masked in Vercel/Supabase/application logs
- [ ] [Pending] Log injection/forging — inject CRLF/newline payloads in user-controlled fields and verify log records cannot be spoofed/split

---

## 11. Denial of Service (Application-Level)

- [ ] [Pending] Login flood — mass login attempts to exhaust rate limiter storage
- [ ] [Pending] Signup flood — mass account creation
- [ ] [Pending] Password reset flood — mass password reset requests to flood email
- [ ] [Pending] Import flood — mass file upload requests
- [ ] [Pending] DSAR export flood — mass GDPR export requests (ZIP generation is CPU-intensive)
- [ ] [Pending] Large payload — submit extremely large JSON bodies to server actions
- [ ] [Pending] Regex DoS (ReDoS) — test input validation regexes with catastrophic backtracking payloads
- [ ] [Pending] Webhook flood — if attacker discovers webhook endpoint, test with high volume (signature validation cost)
- [ ] [Pending] Compliance recalculation bomb — create employee with 10,000 trips, trigger recalculation ⭐ NEW
- [ ] [Pending] Nested object depth — send deeply nested JSON (1000 levels) to server actions ⭐ NEW
- [ ] [Pending] Long string fields — submit 1MB string in employee name field (bypassing client validation) ⭐ NEW
- [ ] [Pending] Slowloris-style attack — hold connections open with slow POST bodies (Vercel likely handles this, but verify) ⭐ NEW
- [ ] [Pending] Concurrent import + export — trigger massive import and DSAR export simultaneously ⭐ NEW

---

## 12. Compliance-Specific Risks

- [ ] [Pending] Data residency — verify data is stored in declared regions (London for prod, Frankfurt for staging)
- [ ] [Pending] Data retention — verify data is deleted according to retention policy (30-day soft-delete window)
- [ ] [Pending] Right to erasure — verify GDPR deletion actually removes data (not just soft-delete)
- [ ] [Pending] Consent management — verify appropriate consent is obtained for data processing
- [ ] [Pending] Data breach notification — verify logging and monitoring infrastructure exists
- [ ] [Pending] Cross-border data transfer — verify no data transferred outside declared regions
- [ ] [Pending] Subprocessor chain — audit third-party data processors (Supabase, Stripe, Vercel, Upstash)
- [ ] [Pending] Audit log timezone consistency — verify all audit timestamps are in UTC, not mixed timezones ⭐ NEW
- [ ] [Pending] Data portability format — verify DSAR export is in a commonly-used, machine-readable format (GDPR Article 20) ⭐ NEW
- [ ] [Pending] Anonymization completeness — after anonymization, search database for any remaining PII references (foreign key names, log entries, Stripe metadata) ⭐ NEW
- [ ] [Pending] Backup data deletion — verify that when GDPR deletion happens, the data is also purged from Supabase backups within the declared retention window (or documented as a limitation) ⭐ NEW
- [ ] [Pending] Third-party data leakage — verify employee PII isn't sent to Stripe metadata, Vercel logs, or error tracking services unnecessarily ⭐ NEW

---

## 13. Supply Chain & Dependency Security ⭐ NEW SECTION

- [ ] [Blocked] Known CVEs in dependencies — run `npm audit` and check for critical/high vulnerabilities [Refs: BL-001] — npm audit endpoint unavailable during execution window.
- [ ] [Pending] Malicious npm package — verify no typosquat packages in `package.json`
- [ ] [Pending] Outdated Supabase client — check for known auth bypass bugs in older `@supabase/supabase-js` versions
- [ ] [Pending] Shadcn/UI XSS — check if any Shadcn components render unsanitized user input
- [ ] [Pending] CDN integrity — verify any externally loaded scripts use Subresource Integrity (SRI) hashes
- [ ] [Pending] Dependency confusion risk — verify private package scopes are enforced and internal package names can't resolve from public npm
- [ ] [Pending] Lock file integrity — verify `package-lock.json` is committed and matches `package.json`
- [ ] [Pending] GitHub Actions secrets exposure — if using CI, verify secrets aren't logged in build output
- [ ] [Pending] GitHub Actions hardening — verify third-party actions are pinned to commit SHAs and untrusted PRs cannot access privileged secrets/tokens

---

## 14. Email System Security (Resend) ⭐ NEW SECTION

- [ ] [Pending] Email header injection — inject newlines in "To" or "Subject" fields to add BCC recipients
- [ ] [Pending] Email spoofing — verify SPF, DKIM, and DMARC records prevent spoofing of `@complyeur.com`
- [ ] [Pending] Password reset email interception — verify reset emails go only to the account holder
- [ ] [Pending] Email bombing — trigger mass password resets or invite emails to a victim's address (rate limiting check)
- [ ] [Pending] HTML injection in email body — user-controlled content (company name, employee name) injected into email templates without sanitization
- [ ] [Pending] Invite email phishing — crafted company name like "Click here to claim reward" rendered in invite email

---

## 15. Race Conditions (TOCTOU) ⭐ NEW SECTION

- [ ] [Pending] Double-spend on seat allocation — two simultaneous requests to add employee when 1 seat remaining
- [ ] [Pending] Concurrent role change + action — change user to Viewer while they're mid-way through a delete operation
- [ ] [Pending] Double subscription checkout — click "Subscribe" twice rapidly, check for duplicate Stripe sessions/charges
- [ ] [Pending] Concurrent GDPR delete + export — trigger deletion and DSAR export simultaneously for same employee
- [ ] [Pending] Concurrent trip creation — create two overlapping trips for same employee simultaneously (validation bypass)
- [ ] [Pending] Soft-delete recovery race — restore employee while retention cron is running hard-delete

---

## 16. Client-Side Security ⭐ NEW SECTION

- [ ] [Pending] Sensitive data in browser storage — check localStorage, sessionStorage, IndexedDB for tokens, PII, or company data
- [ ] [Pending] Sensitive data in React state — inspect React DevTools for leaked data in component state
- [ ] [Pending] Console logging in production — verify no `console.log` statements leak sensitive data
- [ ] [Pending] Service Worker cache — if using service workers, verify sensitive API responses aren't cached
- [ ] [Pending] Browser history exposure — verify sensitive data doesn't appear in URL parameters (visible in browser history)
- [ ] [Pending] Autocomplete on sensitive fields — verify `autocomplete="off"` on fields like employee passport numbers

---

## 17. Vercel Preview Deployment Abuse ⭐ NEW SECTION

- [ ] [Pending] Preview deployment data leakage — preview deployments might connect to production Supabase if env vars aren't isolated
- [ ] [Pending] Branch-based secret exposure — PR from fork might trigger deployment with production secrets
- [ ] [Pending] Preview URL sharing — Vercel preview URLs are long but guessable if deployment pattern is known
- [ ] [Pending] Preview deployment auth bypass — preview deployments might have different auth middleware behavior

---

## Key Files for Testing Reference

| Area | File Path |
|------|-----------|
| Middleware (rate limiting, auth routing) | `middleware.ts` |
| Auth actions (login, signup, OAuth) | `app/(auth)/actions.ts` |
| OAuth callback handler | `app/auth/callback/route.ts` |
| Dashboard mutations (CRUD + permissions) | `app/(dashboard)/actions.ts` |
| Import/upload actions | `app/(dashboard)/import/actions.ts` |
| GDPR actions | `app/(dashboard)/gdpr/actions.ts` |
| GDPR DSAR API endpoint | `app/api/gdpr/dsar/[employeeId]/route.ts` |
| GDPR retention CRON | `app/api/gdpr/cron/retention/route.ts` |
| Stripe webhook handler | `app/api/billing/webhook/route.ts` |
| Stripe checkout | `app/api/billing/checkout/route.ts` |
| Stripe billing portal | `app/api/billing/portal/route.ts` |
| Admin panel actions | `app/admin/companies/[id]/actions.ts` |
| Admin auth (email allowlist) | `lib/admin/auth.ts` |
| RBAC permissions | `lib/permissions.ts` |
| Rate limiting | `lib/rate-limit.ts` |
| Tenant access control | `lib/security/tenant-access.ts` |
| MFA enforcement | `lib/security/mfa.ts` |
| CRON auth | `lib/security/cron-auth.ts` |
| Authorization guards | `lib/security/authorization.ts` |
| CSV sanitization | `lib/exports/sanitize.ts` |
| Redirect validation | `lib/utils/redirect.ts` |
| Supabase admin client (RLS bypass) | `lib/supabase/admin.ts` |
| OAuth linking prevention hook | `supabase/functions/auth-hook-prevent-linking/index.ts` |
| Team management actions | `app/(dashboard)/settings/team/actions.ts` |
| Onboarding actions | `app/(onboarding)/onboarding/actions.ts` |

---

## Notes for the Tester

1. **Multi-tenant architecture** — the most critical attack vector is cross-company data access. Every query is scoped by `company_id` via Supabase Row-Level Security, but application-layer checks must also be verified.

2. **Admin panel** — access is gated by a hardcoded email allowlist and `is_superadmin` database flag. This is a high-value target.

3. **CSP weakness** — the current Content-Security-Policy includes `'unsafe-inline'` for scripts, which significantly weakens XSS protection.

4. **Rate limiting** — IP-based via Upstash Redis. In production, the `X-Forwarded-For` header is trusted from Vercel's proxy. Test whether header spoofing is possible.

5. **File imports** — middleware enforces a 1MB body size limit, but file uploads allow up to 5MB. This mismatch may cause issues with legitimate large imports and should be tested.

6. **Supabase anon key** — publicly visible by design. All security depends on RLS policies being correctly configured on every table.

7. **PostgREST foreign key traversal** ⭐ — Supabase PostgREST allows `?select=*,related_table(*)` syntax which can traverse foreign keys. Verify RLS blocks data leakage through relationship queries.

8. **Next.js data routes** ⭐ — `/_next/data/` endpoints serve JSON versions of server-side props. These often bypass middleware and may leak authenticated data.

9. **Server Actions** ⭐ — Next.js server actions can be called directly via POST with the `$ACTION_ID` header. Test that all server actions enforce auth independently, not relying on layout/page-level checks.

---

## Priority Ranking

Items most likely to yield real findings in this specific stack, ordered by risk:

| Priority | Test Area | Why |
|----------|-----------|-----|
| 🔴 P1 | PostgREST foreign key traversal (§4.5) | Very common Supabase misconfiguration |
| 🔴 P1 | `_next/data` endpoint access (§4.4) | Next.js data routes often bypass middleware |
| 🔴 P1 | User-specific cache leakage (§4.6) | Cache/key mistakes can leak one tenant's data to another |
| 🔴 P1 | Cross-tenant isolation (§2.2) | Business-ending if breached |
| 🔴 P1 | Server Action replay/manipulation (§3.6) | Next.js-specific attack surface most testers miss |
| 🟠 P2 | Race conditions on seat limits (§15) | Very common in B2B SaaS |
| 🟠 P2 | Preview deployment env isolation (§17) | Often overlooked |
| 🟠 P2 | JWT refresh token rotation (§1.4) | Supabase's default behavior needs verification |
| 🟠 P2 | Team invite flow abuse (§2.4) | Team management is a high-value target |
| 🟠 P2 | RPC function abuse via anon key (§4.5) | Direct Supabase endpoint access |
| 🟠 P2 | Host header link poisoning (§1.1) | Can turn reset/invite flows into account-takeover vectors |
| 🟡 P3 | Supply chain / npm audit (§13) | Low effort, high reward quick check |
| 🟡 P3 | CSP `unsafe-inline` exploitation (§3.2/§8.1) | Known weakness in current config |
| 🟡 P3 | Email header injection (§14) | If Resend doesn't sanitize inputs |
| 🟡 P3 | Client-side data leakage (§16) | Quick browser DevTools check |

---

**Total test cases:** ~262+  
**Estimated duration:** 5-10 days (depending on tester experience and scope)  
**Recommended tools:** Burp Suite Pro, OWASP ZAP, Postman, browser DevTools, `npm audit`, custom scripts for race condition testing
