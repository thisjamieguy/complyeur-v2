[
  {
    "id": "CEUR-PT-001",
    "severity": "high",
    "title": "Privileged MFA enforcement is allowlist-based, not role-based",
    "status": "remediated",
    "affected_files": [
      "lib/security/mfa.ts:23",
      "lib/security/mfa.ts:65",
      "lib/security/authorization.ts:56",
      "app/(dashboard)/layout.tsx:20",
      "lib/admin/auth.ts:64",
      "app/(dashboard)/import/actions.ts:155",
      "app/(dashboard)/import/actions.ts:507",
      "app/(dashboard)/actions.ts:247"
    ],
    "checklist_sections": ["1.3", "2.1", "2.3"],
    "impact": "Owner/admin accounts not in allowlist can perform privileged operations without MFA.",
    "recommendation": "Enforce MFA by role and privilege level instead of static email allowlist.",
    "remediated_on": "2026-02-19",
    "remediation_summary": "MFA policy now enforces by privilege (owner/admin/is_superadmin) with fail-closed behavior if profile context cannot be loaded; all remaining privileged call sites now pass context-object arguments.",
    "verification_evidence": [
      "pnpm typecheck (pass, 2026-02-19)",
      "pnpm test (pass: 79 files passed, 2 skipped; 1942 tests passed, 32 skipped)",
      "pnpm test:e2e:multi-user (pass: 1 passed)"
    ]
  },
  {
    "id": "CEUR-PT-002",
    "severity": "medium",
    "title": "Unauthenticated health endpoint leaks operational details",
    "status": "remediated",
    "affected_files": [
      "app/api/health/route.ts:7",
      "app/api/health/route.ts:15",
      "middleware.ts:74",
      "__tests__/unit/health-route.test.ts:17",
      "__tests__/unit/middleware-health-rate-limit.test.ts:46"
    ],
    "checklist_sections": ["10.1", "10.4", "11"],
    "impact": "Exposes version, backend health, and internal errors to unauthenticated callers.",
    "recommendation": "Restrict or sanitize health endpoint responses and apply monitor-only access.",
    "remediated_on": "2026-02-19",
    "remediation_summary": "Health endpoint now returns only `{ status: 'ok' }` or `{ status: 'error' }` with `Cache-Control: no-store`; version/db/error details removed. Middleware now includes `/api/health` in API rate-limit scope (auth callback remains the only API exemption).",
    "verification_evidence": [
      "pnpm test (pass, includes __tests__/unit/health-route.test.ts and __tests__/unit/middleware-health-rate-limit.test.ts)",
      "Unit assertion: /api/health response shape stripped to status-only payload"
    ]
  },
  {
    "id": "CEUR-PT-003",
    "severity": "medium",
    "title": "Rate limit client identity trusts forwarded headers directly",
    "status": "remediated",
    "affected_files": [
      "lib/security/client-ip.ts:71",
      "lib/rate-limit.ts:4",
      "lib/rate-limit.ts:197",
      "app/(auth)/actions.ts:45",
      "lib/admin/audit.ts:27",
      "__tests__/unit/client-ip.test.ts:8"
    ],
    "checklist_sections": ["4.1"],
    "impact": "Header trust mistakes can weaken brute-force protections and attribution.",
    "recommendation": "Use trusted proxy parsing/provider-safe client IP headers and add spoofing tests.",
    "remediated_on": "2026-02-19",
    "remediation_summary": "Introduced centralized trusted client-IP parsing with explicit provider-header precedence, ambiguous X-Forwarded-For rejection, and production single-hop opt-in guard. Wired the shared helper into rate-limit middleware, auth actions, and admin audit logging.",
    "verification_evidence": [
      "pnpm test (pass, includes __tests__/unit/client-ip.test.ts)",
      "pnpm test:e2e:multi-user (pass: 1 passed)"
    ]
  },
  {
    "id": "CEUR-PT-004",
    "severity": "medium",
    "title": "CSP allows unsafe-inline and unsafe-eval",
    "status": "remediated",
    "affected_files": [
      "lib/security/csp.ts:5",
      "middleware.ts:14",
      "app/layout.tsx:33",
      "next.config.ts:35",
      "__tests__/unit/csp.test.ts:11"
    ],
    "checklist_sections": ["3.2", "8.1"],
    "impact": "Weakens CSP effectiveness for XSS mitigation.",
    "recommendation": "Move to nonce/hash CSP in production and remove unsafe directives.",
    "remediated_on": "2026-02-19",
    "remediation_summary": "CSP moved from static next.config header to middleware-generated nonce policy. Production `script-src` now uses nonce + strict-dynamic and removes unsafe-inline/unsafe-eval. Root layout now reads nonce header and applies it to required script tags.",
    "verification_evidence": [
      "pnpm test (pass, includes __tests__/unit/csp.test.ts)",
      "Unit assertion: production script-src excludes unsafe directives and includes nonce"
    ]
  },
  {
    "id": "CEUR-PT-005",
    "severity": "low",
    "title": "Framework fingerprinting via X-Powered-By",
    "status": "remediated",
    "affected_files": [
      "next.config.ts:5"
    ],
    "checklist_sections": ["8.1"],
    "impact": "Increases recon quality for targeted attacks.",
    "recommendation": "Disable powered-by header in production.",
    "remediated_on": "2026-02-19",
    "remediation_summary": "Disabled framework fingerprinting header by setting Next.js `poweredByHeader: false` in runtime configuration.",
    "verification_evidence": [
      "Configuration assertion: next.config.ts sets poweredByHeader to false",
      "pnpm typecheck (pass, 2026-02-19)",
      "pnpm test (pass: 81 files passed, 2 skipped; 1948 tests passed, 32 skipped)"
    ]
  },
  {
    "id": "CEUR-PT-006",
    "severity": "low",
    "title": "Request size controls are inconsistent across layers",
    "status": "remediated",
    "affected_files": [
      "lib/constants/request-limits.ts:1",
      "middleware.ts:66",
      "types/import.ts:2",
      "types/import.ts:22",
      "app/(dashboard)/import/actions.ts:76",
      "__tests__/unit/request-limits.test.ts:10",
      "__tests__/unit/middleware-body-limit.test.ts:46"
    ],
    "checklist_sections": ["4.2", "6.1", "11"],
    "impact": "Inconsistent enforcement increases ambiguity and can cause edge-case failures.",
    "recommendation": "Align upload and middleware limits with endpoint-specific policies.",
    "remediated_on": "2026-02-19",
    "remediation_summary": "Introduced shared request-size policy constants and endpoint-aware middleware enforcement (default 1MB, import 10MB), then aligned import validation to the same source of truth.",
    "verification_evidence": [
      "pnpm test (pass, includes __tests__/unit/request-limits.test.ts and __tests__/unit/middleware-body-limit.test.ts)",
      "Unit assertions validate 1MB non-import cap, 10MB import cap, and boundary error messaging"
    ]
  }
]
